- name: users exist
  user: name={{item.name}} state=present groups={{item.groups}}
  with_items: users
  tags: users

- name: ~/.ssh for users exist
  file: path="/home/{{item.name}}/.ssh" state=directory owner={{item.name}} group={{item.name}} mode=0700
  with_items: users
  tags: users

- name: authorized keys is deployed
  copy: src="authorized_keys_for_{{item.name}}" dest="/home/{{item.name}}/.ssh/authorized_keys" owner={{item.name}} group={{item.name}} mode=0600
  with_items: users
  tags: users

- name: sudo configured
  copy: src="sudoers" dest="/etc/sudoers" owner=root group=root mode=0440

- name: sshd is cofigured
  notify:
    - restart sshd
  copy: src="sshd_config" dest="/etc/ssh/sshd_config" owner=root group=root mode=0600
  tags: sshd

- name: Add nginx stable repository
  apt_repository: repo="ppa:nginx/stable"

- name: Update apt
  apt: update_cache=yes cache_valid_time=3600

- name: Upgrade apt packages
  apt: upgrade=full
